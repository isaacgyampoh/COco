<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="theme-color" content="#0d9488">
<title>Everytin Room POS</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#f0fdfa,#ccfbf1,#fef3c7);min-height:100vh;color:#134e4a}
#loader{position:fixed;inset:0;background:linear-gradient(135deg,#0d9488,#14b8a6,#f59e0b);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px}
#loader.hide{display:none}
#loader h1{font-size:26px;color:#fff}
#loader h1 span{color:#fbbf24}
#loader .spin{width:40px;height:40px;border:4px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#loader p{color:#fff;font-size:14px}
#toast{position:fixed;top:80px;left:50%;transform:translateX(-50%);background:#134e4a;color:#fff;padding:12px 24px;border-radius:30px;font-size:14px;font-weight:600;z-index:9999;display:none}
#toast.show{display:block}
#toast.ok{background:#22c55e}
#toast.err{background:#ef4444}
#login{position:fixed;inset:0;background:linear-gradient(135deg,#0d9488,#14b8a6,#f59e0b);display:flex;align-items:center;justify-content:center;padding:20px;z-index:1000}
#login.hide{display:none}
.login-box{text-align:center;max-width:320px;width:100%}
.login-box h1{font-size:26px;color:#fff;margin-bottom:4px}
.login-box h1 span{color:#fbbf24}
.login-box>p{color:rgba(255,255,255,.8);font-size:13px;margin-bottom:24px}
.login-card{background:#fff;border-radius:20px;padding:28px 24px}
.login-card h2{font-size:18px;font-weight:700;margin-bottom:4px}
.login-card>p{color:#64748b;font-size:12px;margin-bottom:20px}
.pins{display:flex;gap:10px;justify-content:center}
.pin-input{width:48px;height:56px;border:3px solid #e2e8f0;border-radius:12px;font-size:22px;font-weight:700;text-align:center;background:#f8fafc}
.pin-input:focus{outline:none;border-color:#0d9488;background:#fff}
#pin-err{background:#fef2f2;color:#dc2626;padding:10px;border-radius:8px;margin-top:16px;font-size:12px;display:none}
#app{display:none}
#app.show{display:block}
.header{position:fixed;top:0;left:0;right:0;height:56px;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);display:flex;align-items:center;padding:0 16px;gap:10px;z-index:100;border-bottom:1px solid rgba(0,0,0,.05)}
.header-logo{display:flex;align-items:center;gap:8px;font-size:15px;font-weight:800;flex:1}
.header-logo span{color:#f59e0b}
.header-logo .icon{width:34px;height:34px;background:linear-gradient(135deg,#0d9488,#f59e0b);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px}
.header-btn{width:38px;height:38px;border-radius:10px;background:rgba(13,148,136,.08);display:flex;align-items:center;justify-content:center;font-size:16px;border:none;cursor:pointer;position:relative}
.badge{position:absolute;top:0;right:0;min-width:16px;height:16px;background:#ef4444;border-radius:8px;font-size:9px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center}
.nav{position:fixed;bottom:0;left:0;right:0;background:rgba(255,255,255,.95);backdrop-filter:blur(10px);display:flex;padding:8px 12px calc(8px + env(safe-area-inset-bottom));z-index:100;border-top:1px solid rgba(0,0,0,.05)}
.nav-btn{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;padding:6px;border-radius:10px;font-size:9px;font-weight:600;color:#94a3b8;border:none;background:none;cursor:pointer}
.nav-btn span{font-size:20px}
.nav-btn.on{color:#0d9488;background:rgba(13,148,136,.1)}
.fab{position:fixed;bottom:calc(70px + env(safe-area-inset-bottom));right:16px;width:54px;height:54px;background:linear-gradient(135deg,#0d9488,#f59e0b);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:24px;color:#fff;z-index:99;box-shadow:0 4px 20px rgba(13,148,136,.4);border:none;cursor:pointer}
.fab .badge{top:-4px;right:-4px;min-width:20px;height:20px;background:#f59e0b;border:2px solid #fff}
.main{padding:66px 16px calc(76px + env(safe-area-inset-bottom))}
.page{display:none}
.page.on{display:block}
.page-title{font-size:20px;font-weight:800;margin-bottom:16px}
.stats{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px}
.stat{background:#fff;border-radius:14px;padding:14px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
.stat-icon{font-size:24px;margin-bottom:6px}
.stat-label{font-size:9px;font-weight:600;color:#94a3b8;text-transform:uppercase}
.stat-value{font-size:18px;font-weight:800;margin-top:2px}
.card{background:#fff;border-radius:14px;padding:14px;margin-bottom:12px;box-shadow:0 2px 10px rgba(0,0,0,.05)}
.card-title{font-size:13px;font-weight:700;margin-bottom:10px}
.btn{height:38px;padding:0 14px;border-radius:10px;font-size:12px;font-weight:600;border:none;cursor:pointer;display:inline-flex;align-items:center;justify-content:center;gap:6px}
.btn-p{background:linear-gradient(135deg,#0d9488,#f59e0b);color:#fff}
.btn-s{background:#22c55e;color:#fff}
.btn-d{background:#ef4444;color:#fff}
.btn-g{background:rgba(13,148,136,.08);color:#134e4a}
.btn-sm{height:32px;padding:0 10px;font-size:11px}
.input{width:100%;height:42px;padding:0 12px;background:#f8fafc;border:2px solid #e2e8f0;border-radius:10px;font-size:14px;font-family:inherit}
.input:focus{outline:none;border-color:#0d9488}
.products{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.product{background:#fff;border-radius:12px;padding:10px;cursor:pointer;box-shadow:0 2px 10px rgba(0,0,0,.05);border:2px solid transparent}
.product:active{border-color:#0d9488}
.product.out{opacity:.4;pointer-events:none}
.product-img{width:100%;height:60px;background:#f0fdfa;border-radius:8px;margin-bottom:6px;display:flex;align-items:center;justify-content:center;font-size:28px;overflow:hidden}
.product-img img{width:100%;height:100%;object-fit:cover}
.product-name{font-size:11px;font-weight:600;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.product-price{font-size:15px;font-weight:800;color:#0d9488}
.product-stock{display:inline-block;padding:2px 6px;border-radius:10px;font-size:8px;font-weight:700;margin-top:4px}
.product-stock.ok{background:rgba(34,197,94,.1);color:#22c55e}
.product-stock.low{background:rgba(245,158,11,.1);color:#f59e0b}
.product-stock.out{background:rgba(239,68,68,.1);color:#ef4444}
.modes{display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;margin-bottom:14px}
.mode{height:50px;background:#fff;border:2px solid #e2e8f0;border-radius:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:2px;font-size:9px;font-weight:700;color:#94a3b8;cursor:pointer}
.mode span{font-size:18px}
.mode.on{border-color:#0d9488;color:#0d9488}
#cartBg{position:fixed;inset:0;background:rgba(0,0,0,.4);z-index:300;display:none}
#cartBg.on{display:block}
#cart{position:fixed;bottom:0;left:0;right:0;background:#fff;border-radius:20px 20px 0 0;max-height:80vh;z-index:301;transform:translateY(100%);transition:.3s;display:flex;flex-direction:column}
#cart.on{transform:translateY(0)}
.cart-bar{width:36px;height:4px;background:#e2e8f0;border-radius:2px;margin:10px auto}
.cart-head{display:flex;align-items:center;justify-content:space-between;padding:0 16px 10px;border-bottom:1px solid #f1f5f9}
.cart-head h3{font-size:15px;font-weight:800}
.cart-body{flex:1;overflow-y:auto;padding:10px 16px;max-height:35vh}
.cart-item{display:flex;align-items:center;gap:8px;padding:8px;background:#f8fafc;border-radius:10px;margin-bottom:6px}
.cart-item-img{width:36px;height:36px;background:#f0fdfa;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:16px;overflow:hidden}
.cart-item-img img{width:100%;height:100%;object-fit:cover}
.cart-item-info{flex:1;min-width:0}
.cart-item-name{font-size:11px;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.cart-item-price{font-size:10px;color:#64748b}
.cart-qty{display:flex;align-items:center;gap:4px}
.cart-qty-btn{width:26px;height:26px;border-radius:6px;background:#fff;border:2px solid #e2e8f0;font-size:14px;cursor:pointer}
.cart-qty-num{font-size:12px;font-weight:700;min-width:18px;text-align:center}
.cart-item-total{font-size:12px;font-weight:700;color:#0d9488}
.cart-item-del{width:26px;height:26px;border-radius:6px;background:rgba(239,68,68,.1);color:#ef4444;font-size:10px;border:none;cursor:pointer}
.cart-empty{text-align:center;padding:24px;color:#94a3b8}
.cart-empty span{font-size:40px;display:block;margin-bottom:8px;opacity:.3}
.cart-foot{padding:12px 16px calc(12px + env(safe-area-inset-bottom));border-top:1px solid #f1f5f9;background:#fafafa}
.cart-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;font-size:12px;color:#64748b}
.cart-row b{color:#134e4a}
.cart-row.tot{font-size:15px;font-weight:800;padding-top:8px;border-top:2px dashed #e2e8f0}
.cart-row.tot b{color:#0d9488}
.disc-inp{width:55px;height:28px;padding:0 6px;background:#fff;border:2px solid #e2e8f0;border-radius:6px;font-size:11px;font-weight:600;text-align:right}
.pay-btn{width:100%;height:46px;background:linear-gradient(135deg,#0d9488,#f59e0b);border-radius:12px;color:#fff;font-size:14px;font-weight:700;border:none;cursor:pointer;margin-top:10px}
.pay-btn:disabled{opacity:.5}
.modal{position:fixed;inset:0;z-index:400;display:none;align-items:flex-end;justify-content:center}
.modal.on{display:flex}
.modal-bg{position:absolute;inset:0;background:rgba(0,0,0,.4)}
.modal-box{position:relative;background:#fff;border-radius:20px 20px 0 0;width:100%;max-height:80vh;display:flex;flex-direction:column}
.modal-head{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #f1f5f9}
.modal-head h3{font-size:15px;font-weight:700}
.modal-close{width:32px;height:32px;background:#f1f5f9;border-radius:8px;font-size:16px;border:none;cursor:pointer}
.modal-body{flex:1;overflow-y:auto;padding:16px}
.modal-foot{padding:12px 16px calc(12px + env(safe-area-inset-bottom));border-top:1px solid #f1f5f9;display:flex;gap:8px}
.field{margin-bottom:12px}
.field-label{display:block;font-size:10px;font-weight:600;color:#64748b;margin-bottom:4px}
table{width:100%;border-collapse:collapse}
th{text-align:left;padding:8px;background:#f8fafc;font-size:9px;font-weight:700;color:#64748b;text-transform:uppercase}
td{padding:8px;border-bottom:1px solid #f1f5f9;font-size:11px}
.empty{text-align:center;padding:24px;color:#94a3b8}
.empty span{font-size:36px;display:block;margin-bottom:6px;opacity:.3}
.top-item{display:flex;align-items:center;gap:8px;padding:10px;background:#f8fafc;border-radius:10px;margin-bottom:6px}
.top-rank{width:22px;height:22px;background:linear-gradient(135deg,#0d9488,#f59e0b);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:10px}
.top-info{flex:1}
.top-name{font-weight:600;font-size:12px}
.hero{background:linear-gradient(135deg,#0d9488,#f59e0b);border-radius:14px;padding:16px;color:#fff;margin-bottom:14px}
.hero.d{background:#ef4444}
.hero small{font-size:11px;opacity:.9}
.hero strong{display:block;font-size:24px;font-weight:800;margin-top:4px}
.exp-item{display:flex;align-items:center;gap:10px;padding:10px;background:#f8fafc;border-radius:10px;margin-bottom:6px}
.exp-icon{width:36px;height:36px;background:rgba(239,68,68,.1);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:18px}
.exp-info{flex:1}
.exp-title{font-weight:600;font-size:12px}
.exp-date{font-size:10px;color:#64748b}
.exp-amt{font-weight:700;color:#ef4444;font-size:12px}
@media print{body *{visibility:hidden}#printArea,#printArea *{visibility:visible}#printArea{position:fixed;left:0;top:0;width:80mm;padding:3mm;background:#fff;font-family:'Courier New',monospace;font-size:11px}}
</style>
</head>
<body>
<div id="loader"><h1>Everytin <span>Room</span></h1><div class="spin"></div><p id="loadTxt">Loading...</p></div>
<div id="toast"></div>
<div id="login"><div class="login-box"><h1>Everytin <span>Room</span></h1><p>Your One Stop Shop</p><div class="login-card"><h2>Welcome!</h2><p>Enter your 4-digit PIN</p><div class="pins"><input type="tel" maxlength="1" class="pin-input" id="p1" oninput="pinIn(1)" inputmode="numeric"><input type="tel" maxlength="1" class="pin-input" id="p2" oninput="pinIn(2)" inputmode="numeric"><input type="tel" maxlength="1" class="pin-input" id="p3" oninput="pinIn(3)" inputmode="numeric"><input type="tel" maxlength="1" class="pin-input" id="p4" oninput="pinIn(4)" inputmode="numeric"></div><div id="pin-err">Invalid PIN</div></div></div></div>
<div id="app">
<header class="header"><div class="header-logo"><div class="icon">ğŸ›’</div>Everytin <span>Room</span></div><button class="header-btn" onclick="goTo('orders')">ğŸ›ï¸<span class="badge" id="ordBadge">0</span></button><button class="header-btn" onclick="openMenu()">â˜°</button></header>
<button class="fab" onclick="openCart()">ğŸ›’<span class="badge" id="cartBadge">0</span></button>
<nav class="nav"><button class="nav-btn on" data-pg="pos" onclick="goTo('pos')"><span>ğŸ›’</span>POS</button><button class="nav-btn" data-pg="orders" onclick="goTo('orders')"><span>ğŸ›ï¸</span>Orders</button><button class="nav-btn" data-pg="receipts" onclick="goTo('receipts')"><span>ğŸ§¾</span>History</button><button class="nav-btn" data-pg="dash" onclick="goTo('dash')"><span>ğŸ“Š</span>More</button></nav>
<main class="main">
<section class="page on" id="pgPos"><h1 class="page-title">ğŸ›’ POS</h1><input type="text" class="input" placeholder="ğŸ” Search products..." id="posQ" oninput="renderPOS()" style="margin-bottom:12px"><div class="modes"><button class="mode on" id="mdRet" onclick="setMode('retail')"><span>ğŸ›ï¸</span>Retail</button><button class="mode" id="mdWho" onclick="setMode('wholesale')"><span>ğŸ­</span>Wholesale</button><button class="mode" id="mdBun" onclick="setMode('bundle')"><span>ğŸ</span>Bundle</button></div><div class="products" id="prodGrid"></div></section>
<section class="page" id="pgOrders"><h1 class="page-title">ğŸ›ï¸ Orders</h1><div class="hero"><small>Pending Orders</small><strong id="pendCnt">0</strong></div><div id="ordersList"></div></section>
<section class="page" id="pgReceipts"><h1 class="page-title">ğŸ§¾ Sales History</h1><div class="card"><input type="text" class="input" placeholder="ğŸ” Search..." id="rcQ" oninput="renderReceipts()" style="margin-bottom:10px"><table><thead><tr><th>Receipt</th><th>Date</th><th>Total</th><th></th></tr></thead><tbody id="rcTbl"></tbody></table></div></section>
<section class="page" id="pgDash"><h1 class="page-title">ğŸ“Š Dashboard</h1><div class="stats"><div class="stat"><div class="stat-icon">ğŸ’°</div><div class="stat-label">Today Sales</div><div class="stat-value" id="dSales">GHS 0</div></div><div class="stat"><div class="stat-icon">ğŸ’µ</div><div class="stat-label">Profit</div><div class="stat-value" id="dProfit">GHS 0</div></div><div class="stat"><div class="stat-icon">ğŸ›ï¸</div><div class="stat-label">Pending</div><div class="stat-value" id="dPend">0</div></div><div class="stat"><div class="stat-icon">ğŸ’¸</div><div class="stat-label">Expenses</div><div class="stat-value" id="dExp">GHS 0</div></div></div><div class="card"><div class="card-title">ğŸ† Top Selling Today</div><div id="topToday"></div></div></section>
<section class="page" id="pgProducts"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><h1 class="page-title" style="margin:0">ğŸ“¦ Products</h1><button class="btn btn-p btn-sm" onclick="openProdModal()">â•</button></div><div class="card"><table><thead><tr><th>Name</th><th>Price</th><th>Stock</th><th></th></tr></thead><tbody id="prTbl"></tbody></table></div></section>
<section class="page" id="pgExpenses"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><h1 class="page-title" style="margin:0">ğŸ’¸ Expenses</h1><button class="btn btn-d btn-sm" onclick="openExpModal()">â•</button></div><div class="hero d"><small>This Month</small><strong id="expMonth">GHS 0</strong></div><div class="card"><div id="expList"></div></div></section>
<section class="page" id="pgStaff"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px"><h1 class="page-title" style="margin:0">ğŸ‘¤ Staff</h1><button class="btn btn-p btn-sm" onclick="openStaffModal()">â•</button></div><div class="card"><table><thead><tr><th>Name</th><th>Role</th><th></th></tr></thead><tbody id="sfTbl"></tbody></table></div></section>
</main>
<div id="cartBg" onclick="closeCart()"></div>
<div id="cart"><div class="cart-bar"></div><div class="cart-head"><h3>ğŸ›’ Cart <span id="cartCnt">0</span></h3><div style="display:flex;gap:6px"><button class="btn btn-d btn-sm" onclick="clearCart()">ğŸ—‘ï¸</button></div></div><div class="cart-body" id="cartBody"><div class="cart-empty"><span>ğŸ›’</span><p>Empty cart</p></div></div><div class="cart-foot"><div class="cart-row"><span>Subtotal</span><b id="cartSub">GHS 0</b></div><div class="cart-row"><span>Discount</span><input type="number" class="disc-inp" id="cartDisc" value="0" min="0" onchange="calcCart()"></div><div class="cart-row tot"><span>Total</span><b id="cartTot">GHS 0</b></div><button class="pay-btn" id="payBtn" onclick="openPayModal()" disabled>âœ“ Checkout</button></div></div>
</div>
<div class="modal" id="payModal"><div class="modal-bg" onclick="closeMod('payModal')"></div><div class="modal-box"><div class="modal-head"><h3>ğŸ’³ Payment</h3><button class="modal-close" onclick="closeMod('payModal')">âœ•</button></div><div class="modal-body"><div class="field"><label class="field-label">Method</label><select class="input" id="payMethod"><option value="cash">ğŸ’µ Cash</option><option value="momo">ğŸ“± MoMo</option><option value="card">ğŸ’³ Card</option></select></div><div class="hero" style="margin-top:12px"><small>Total Due</small><strong id="payTotal">GHS 0</strong></div></div><div class="modal-foot"><button class="btn btn-p" style="flex:1" onclick="completeSale()">âœ“ Confirm & Print</button></div></div></div>
<div class="modal" id="prModal"><div class="modal-bg" onclick="closeMod('prModal')"></div><div class="modal-box"><div class="modal-head"><h3 id="prModalTitle">Add Product</h3><button class="modal-close" onclick="closeMod('prModal')">âœ•</button></div><div class="modal-body"><input type="hidden" id="ePrId"><div class="field"><label class="field-label">Name</label><input type="text" class="input" id="prName"></div><div class="field"><label class="field-label">Category</label><input type="text" class="input" id="prCat"></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><div class="field"><label class="field-label">Cost</label><input type="number" class="input" id="prCost" min="0" step="0.01"></div><div class="field"><label class="field-label">Price</label><input type="number" class="input" id="prPrice" min="0" step="0.01"></div></div><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px"><div class="field"><label class="field-label">Wholesale</label><input type="number" class="input" id="prWhole" min="0" step="0.01"></div><div class="field"><label class="field-label">Stock</label><input type="number" class="input" id="prQty" min="0"></div></div></div><div class="modal-foot"><button class="btn btn-g" onclick="closeMod('prModal')">Cancel</button><button class="btn btn-p" onclick="saveProd()">ğŸ’¾ Save</button></div></div></div>
<div class="modal" id="expModal"><div class="modal-bg" onclick="closeMod('expModal')"></div><div class="modal-box"><div class="modal-head"><h3>ğŸ’¸ Add Expense</h3><button class="modal-close" onclick="closeMod('expModal')">âœ•</button></div><div class="modal-body"><div class="field"><label class="field-label">Title</label><input type="text" class="input" id="expTitle"></div><div class="field"><label class="field-label">Category</label><select class="input" id="expCat"><option value="utilities">âš¡ Utilities</option><option value="rent">ğŸ  Rent</option><option value="supplies">ğŸ“¦ Supplies</option><option value="transport">ğŸš— Transport</option><option value="salary">ğŸ‘¤ Salary</option><option value="other">ğŸ“ Other</option></select></div><div class="field"><label class="field-label">Amount</label><input type="number" class="input" id="expAmt" min="0" step="0.01"></div></div><div class="modal-foot"><button class="btn btn-g" onclick="closeMod('expModal')">Cancel</button><button class="btn btn-d" onclick="saveExp()">ğŸ’¾ Save</button></div></div></div>
<div class="modal" id="sfModal"><div class="modal-bg" onclick="closeMod('sfModal')"></div><div class="modal-box"><div class="modal-head"><h3 id="sfModalTitle">Add Staff</h3><button class="modal-close" onclick="closeMod('sfModal')">âœ•</button></div><div class="modal-body"><input type="hidden" id="eSfId"><div class="field"><label class="field-label">Name</label><input type="text" class="input" id="sfName"></div><div class="field"><label class="field-label">Role</label><select class="input" id="sfRole"><option value="cashier">Cashier</option><option value="admin">Admin</option></select></div><div class="field"><label class="field-label">PIN (4 digits)</label><input type="tel" class="input" id="sfPin" maxlength="4" inputmode="numeric"></div></div><div class="modal-foot"><button class="btn btn-g" onclick="closeMod('sfModal')">Cancel</button><button class="btn btn-p" onclick="saveStaff()">ğŸ’¾ Save</button></div></div></div>
<div class="modal" id="rcptModal"><div class="modal-bg" onclick="closeMod('rcptModal')"></div><div class="modal-box"><div class="modal-head"><h3>ğŸ§¾ Receipt</h3><button class="modal-close" onclick="closeMod('rcptModal')">âœ•</button></div><div class="modal-body" id="rcptBody"></div><div class="modal-foot"><button class="btn btn-g" onclick="closeMod('rcptModal')">Close</button><button class="btn btn-p" onclick="printRcpt()">ğŸ–¨ï¸ Print</button></div></div></div>
<div class="modal" id="menuModal"><div class="modal-bg" onclick="closeMod('menuModal')"></div><div class="modal-box"><div class="modal-head"><h3>â˜° Menu</h3><button class="modal-close" onclick="closeMod('menuModal')">âœ•</button></div><div class="modal-body"><div style="display:flex;flex-direction:column;gap:8px"><button class="btn btn-g" style="justify-content:flex-start" onclick="goTo('dash');closeMod('menuModal')">ğŸ“Š Dashboard</button><button class="btn btn-g" style="justify-content:flex-start" onclick="goTo('products');closeMod('menuModal')">ğŸ“¦ Products</button><button class="btn btn-g" style="justify-content:flex-start" onclick="goTo('expenses');closeMod('menuModal')">ğŸ’¸ Expenses</button><button class="btn btn-g" style="justify-content:flex-start" onclick="goTo('staff');closeMod('menuModal')">ğŸ‘¤ Staff</button><button class="btn btn-d" style="justify-content:flex-start;margin-top:12px" onclick="logout()">ğŸšª Logout</button></div></div></div></div>
<div id="printArea"></div>
<script>
const SB='https://gijflxcfxavzdrllqfiv.supabase.co';
const SK='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdpamZseGNmeGF2emRybGxxZml2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk4NDczNjksImV4cCI6MjA4NTQyMzM2OX0.uJ5kx3PKe8H8ymoHKxCaAuVFFrpE5t7gVFTHOnhSVV0';
const SHOP={name:'Everytin Room',tag:'Your One Stop Shop',ph1:'054 920 7471',ph2:'024 531 5581',addr:'Adenta Aviation Road'};
const db=window.supabase.createClient(SB,SK);
let shop=null,user=null,products=[],sales=[],staff=[],orders=[],expenses=[],bundles=[],cart=[],mode='retail',curRcpt=null;
const $=id=>document.getElementById(id),n=v=>parseFloat(v)||0,m=v=>'GHS '+n(v).toFixed(2);
const toast=(t,ok)=>{const e=$('toast');e.textContent=t;e.className='show'+(ok===true?' ok':ok===false?' err':'');setTimeout(()=>e.className='',2500)};
const openMod=id=>$(id).classList.add('on'),closeMod=id=>$(id).classList.remove('on');
const openMenu=()=>openMod('menuModal');
const openCart=()=>{$('cart').classList.add('on');$('cartBg').classList.add('on')};
const closeCart=()=>{$('cart').classList.remove('on');$('cartBg').classList.remove('on')};
const fmtD=d=>d?new Date(d).toLocaleDateString('en-GB'):'-';
const isoD=d=>d?new Date(d).toISOString().split('T')[0]:'';
const td=()=>new Date().toISOString().split('T')[0];
const catIcon=c=>({utilities:'âš¡',rent:'ğŸ ',supplies:'ğŸ“¦',transport:'ğŸš—',salary:'ğŸ‘¤',other:'ğŸ“'})[c]||'ğŸ“';
async function init(){$('loadTxt').textContent='Connecting...';try{const{data:s,error}=await db.from('shops').select('*').eq('slug','everytin-room').single();if(error||!s){$('loadTxt').textContent='Setup required';alert('Shop not found. Please run the SQL setup first.');return}shop=s;await loadStaff();$('loader').classList.add('hide');$('p1').focus()}catch(e){$('loadTxt').textContent='Connection error';alert('Cannot connect to database')}}
function pinIn(i){if($('p'+i).value.length===1&&i<4)$('p'+(i+1)).focus();if(i===4&&$('p4').value)setTimeout(tryLogin,100)}
async function tryLogin(){const pin=$('p1').value+$('p2').value+$('p3').value+$('p4').value;if(pin.length!==4)return;const u=staff.find(s=>s.pin===pin&&s.active);if(u){user=u;$('login').classList.add('hide');$('app').classList.add('show');await loadAll();goTo('pos');toast('Welcome!',true)}else{$('pin-err').style.display='block';for(let i=1;i<=4;i++)$('p'+i).value='';$('p1').focus();setTimeout(()=>$('pin-err').style.display='none',2500)}}
function logout(){user=null;$('app').classList.remove('show');$('login').classList.remove('hide');for(let i=1;i<=4;i++)$('p'+i).value='';$('p1').focus();cart=[];closeMod('menuModal')}
async function loadAll(){$('loadTxt').textContent='Loading data...';$('loader').classList.remove('hide');await Promise.all([loadProducts(),loadSales(),loadOrders(),loadBundles(),loadExpenses()]);renderAll();$('loader').classList.add('hide')}
async function loadStaff(){const{data}=await db.from('users').select('*').eq('shop_id',shop.id);staff=data||[]}
async function loadProducts(){const{data}=await db.from('products').select('*').eq('shop_id',shop.id).eq('active',true).order('name');products=data||[]}
async function loadSales(){const{data}=await db.from('sales').select('*,sale_items(*)').eq('shop_id',shop.id).order('created_at',{ascending:false}).limit(100);sales=data||[]}
async function loadOrders(){const{data}=await db.from('whatsapp_orders').select('*').eq('shop_id',shop.id).eq('status','pending');orders=data||[]}
async function loadBundles(){const{data}=await db.from('bundles').select('*,bundle_items(*)').eq('shop_id',shop.id).eq('active',true);bundles=data||[]}
async function loadExpenses(){const{data}=await db.from('expenses').select('*').eq('shop_id',shop.id).order('created_at',{ascending:false});expenses=data||[]}
function goTo(pg){document.querySelectorAll('.page').forEach(p=>p.classList.remove('on'));document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('on'));const el=$('pg'+pg.charAt(0).toUpperCase()+pg.slice(1));if(el)el.classList.add('on');document.querySelectorAll(`[data-pg="${pg}"]`).forEach(b=>b.classList.add('on'))}
function renderAll(){renderDash();renderPOS();renderReceipts();renderProducts();renderStaff();renderOrdBadge();renderExpenses()}
function renderDash(){const today=td();let tS=0,tP=0;const ps={};for(const s of sales){if(isoD(s.created_at)!==today)continue;tS+=n(s.total);tP+=n(s.profit);for(const i of(s.sale_items||[]))ps[i.name]=(ps[i.name]||0)+i.quantity}let tE=0;for(const e of expenses)if(isoD(e.created_at)===today)tE+=n(e.amount);$('dSales').textContent=m(tS);$('dProfit').textContent=m(tP);$('dPend').textContent=orders.length;$('dExp').textContent=m(tE);const top=Object.entries(ps).sort((a,b)=>b[1]-a[1]).slice(0,5);$('topToday').innerHTML=top.length?top.map((p,i)=>`<div class="top-item"><div class="top-rank">${i+1}</div><div class="top-info"><div class="top-name">${p[0]}</div></div><span style="color:#64748b;font-size:11px">${p[1]} sold</span></div>`).join(''):'<p style="color:#94a3b8;text-align:center;padding:16px">No sales today</p>'}
function renderOrdBadge(){const c=orders.length;$('ordBadge').textContent=c;$('ordBadge').style.display=c>0?'flex':'none';$('pendCnt').textContent=c}
function setMode(md){mode=md;$('mdRet').classList.toggle('on',md==='retail');$('mdWho').classList.toggle('on',md==='wholesale');$('mdBun').classList.toggle('on',md==='bundle');renderPOS()}
function renderPOS(){const q=($('posQ')?.value||'').toLowerCase();let h='';if(mode==='bundle'){for(const b of bundles)if(b.name.toLowerCase().includes(q))h+=`<div class="product" onclick="addBundle('${b.id}')"><div class="product-img">ğŸ</div><div class="product-name">${b.name}</div><div class="product-price">${m(b.bundle_price)}</div></div>`}else{for(const p of products){if(!p.name.toLowerCase().includes(q))continue;const pr=mode==='wholesale'&&n(p.wholesale_price)>0?n(p.wholesale_price):n(p.price);const qt=n(p.quantity),cl=qt===0?'out':qt<=5?'low':'ok';h+=`<div class="product${qt===0?' out':''}" onclick="addProd('${p.id}')"><div class="product-img">ğŸ“¦</div><div class="product-name">${p.name}</div><div class="product-price">${m(pr)}</div><span class="product-stock ${cl}">${qt}</span></div>`}}$('prodGrid').innerHTML=h||'<div class="empty" style="grid-column:1/-1"><span>ğŸ“¦</span><p>No products</p></div>'}
function addProd(id){const p=products.find(x=>x.id===id);if(!p||n(p.quantity)===0)return;const pr=mode==='wholesale'&&n(p.wholesale_price)>0?n(p.wholesale_price):n(p.price);const ex=cart.find(c=>c.pid===id);if(ex){if(ex.qty<n(p.quantity)){ex.qty++;ex.total=ex.qty*ex.price}else{toast('Stock limit',false);return}}else cart.push({pid:id,name:p.name,price:pr,cost:n(p.cost_price),qty:1,total:pr});renderCart();toast('Added',true)}
function addBundle(id){const b=bundles.find(x=>x.id===id);if(!b)return;const ex=cart.find(c=>c.bid===id);if(ex){ex.qty++;ex.total=ex.qty*ex.price}else cart.push({bid:id,name:b.name,price:n(b.bundle_price),cost:0,qty:1,total:n(b.bundle_price),is_b:true});renderCart();toast('Added',true)}
function renderCart(){const cnt=cart.reduce((a,c)=>a+c.qty,0);$('cartCnt').textContent=cnt;$('cartBadge').textContent=cnt;$('payBtn').disabled=cnt===0;$('cartBody').innerHTML=cnt?cart.map((c,i)=>`<div class="cart-item"><div class="cart-item-img">${c.is_b?'ğŸ':'ğŸ“¦'}</div><div class="cart-item-info"><div class="cart-item-name">${c.name}</div><div class="cart-item-price">${m(c.price)}</div></div><div class="cart-qty"><button class="cart-qty-btn" onclick="chgQty(${i},-1)">âˆ’</button><span class="cart-qty-num">${c.qty}</span><button class="cart-qty-btn" onclick="chgQty(${i},1)">+</button></div><span class="cart-item-total">${m(c.total)}</span><button class="cart-item-del" onclick="remItem(${i})">âœ•</button></div>`).join(''):'<div class="cart-empty"><span>ğŸ›’</span><p>Empty cart</p></div>';calcCart()}
function chgQty(i,d){const c=cart[i];if(!c)return;const nq=c.qty+d;if(nq<1){remItem(i);return}if(!c.is_b){const p=products.find(x=>x.id===c.pid);if(p&&nq>n(p.quantity)){toast('Stock limit',false);return}}c.qty=nq;c.total=c.qty*c.price;renderCart()}
function remItem(i){cart.splice(i,1);renderCart()}
function clearCart(){if(!cart.length||!confirm('Clear cart?'))return;cart=[];renderCart()}
function calcCart(){const sub=cart.reduce((a,c)=>a+c.total,0);const d=n($('cartDisc').value);$('cartSub').textContent=m(sub);$('cartTot').textContent=m(Math.max(0,sub-d))}
function openPayModal(){if(!cart.length)return;$('payMethod').value='cash';$('payTotal').textContent=m(cart.reduce((a,c)=>a+c.total,0)-n($('cartDisc').value));openMod('payModal')}
async function completeSale(){$('loader').classList.remove('hide');$('loadTxt').textContent='Processing...';const disc=n($('cartDisc').value),sub=cart.reduce((a,c)=>a+c.total,0),tot=sub-disc,profit=cart.reduce((a,c)=>a+(c.price-c.cost)*c.qty,0)-disc,rcNo='ER-'+Date.now().toString(36).toUpperCase();const{data:sale,error}=await db.from('sales').insert({shop_id:shop.id,user_id:user.id,receipt_no:rcNo,subtotal:sub,discount:disc,total:tot,profit,payment_method:$('payMethod').value,sale_type:mode}).select().single();if(error){$('loader').classList.add('hide');toast('Error',false);return}const items=cart.map(c=>({sale_id:sale.id,product_id:c.pid||null,bundle_id:c.bid||null,name:c.name,quantity:c.qty,unit_price:c.price,cost_price:c.cost,line_total:c.total}));await db.from('sale_items').insert(items);for(const c of cart)if(c.pid)await db.rpc('update_stock',{p_product_id:c.pid,p_quantity:-c.qty});$('loader').classList.add('hide');toast(rcNo,true);curRcpt={...sale,sale_items:items};cart=[];$('cartDisc').value=0;renderCart();closeMod('payModal');closeCart();printTherm(curRcpt);await loadAll()}
function genTherm(s){const items=s.sale_items||[];const d=new Date(s.created_at);return`<div style="font-family:'Courier New',monospace;font-size:11px;width:72mm;padding:2mm"><div style="text-align:center"><b style="font-size:14px">${SHOP.name}</b><br><span style="font-size:8px">${SHOP.tag}</span><br><span style="font-size:8px">Tel: ${SHOP.ph1} / ${SHOP.ph2}</span><br><span style="font-size:8px">${SHOP.addr}</span></div><hr style="border:none;border-top:1px dashed #000;margin:2mm 0"><div style="display:flex;justify-content:space-between;font-size:9px"><span>Receipt:</span><span>${s.receipt_no}</span></div><div style="display:flex;justify-content:space-between;font-size:9px"><span>Date:</span><span>${d.toLocaleDateString('en-GB')} ${d.toLocaleTimeString('en-GB',{hour:'2-digit',minute:'2-digit'})}</span></div><hr style="border:none;border-top:1px dashed #000;margin:2mm 0">${items.map(i=>`<div style="margin:1mm 0"><div style="font-size:9px">${i.name}</div><div style="display:flex;justify-content:space-between;font-size:8px"><span>${i.quantity} x ${m(i.unit_price)}</span><span>${m(i.line_total)}</span></div></div>`).join('')}<hr style="border:none;border-top:1px dashed #000;margin:2mm 0"><div style="display:flex;justify-content:space-between;font-size:9px"><span>Subtotal:</span><span>${m(s.subtotal)}</span></div>${n(s.discount)>0?`<div style="display:flex;justify-content:space-between;font-size:9px"><span>Discount:</span><span>-${m(s.discount)}</span></div>`:''}<div style="display:flex;justify-content:space-between;font-size:12px;font-weight:bold;margin-top:1mm"><span>TOTAL:</span><span>${m(s.total)}</span></div><hr style="border:none;border-top:1px dashed #000;margin:2mm 0"><div style="display:flex;justify-content:space-between;font-size:9px"><span>Payment:</span><span>${(s.payment_method||'CASH').toUpperCase()}</span></div><div style="text-align:center;font-size:8px;margin-top:2mm">Thank you for shopping!<br>Find us on Google Maps</div></div>`}
function printTherm(s){$('printArea').innerHTML=genTherm(s);setTimeout(()=>window.print(),200)}
function showRcpt(s){curRcpt=s;$('rcptBody').innerHTML=genTherm(s);openMod('rcptModal')}
function printRcpt(){if(curRcpt)printTherm(curRcpt)}
function renderReceipts(){const q=($('rcQ')?.value||'').toLowerCase();$('rcTbl').innerHTML=sales.filter(s=>s.receipt_no.toLowerCase().includes(q)).slice(0,50).map(s=>`<tr><td><b style="color:#0d9488">${s.receipt_no}</b></td><td>${fmtD(s.created_at)}</td><td><b>${m(s.total)}</b></td><td><div style="display:flex;gap:4px"><button class="btn btn-g btn-sm" onclick="viewRcpt('${s.id}')">ğŸ‘ï¸</button><button class="btn btn-p btn-sm" onclick="printById('${s.id}')">ğŸ–¨ï¸</button></div></td></tr>`).join('')||'<tr><td colspan="4"><div class="empty"><span>ğŸ§¾</span>No receipts</div></td></tr>'}
function viewRcpt(id){const s=sales.find(x=>x.id===id);if(s)showRcpt(s)}
function printById(id){const s=sales.find(x=>x.id===id);if(s)printTherm(s)}
function renderProducts(){$('prTbl').innerHTML=products.map(p=>{const qt=n(p.quantity);return`<tr><td><b>${p.name}</b><br><small style="color:#94a3b8">${p.category||''}</small></td><td style="color:#0d9488;font-weight:700">${m(p.price)}</td><td style="font-weight:700;color:${qt===0?'#ef4444':qt<=5?'#f59e0b':'inherit'}">${qt}</td><td><div style="display:flex;gap:4px"><button class="btn btn-g btn-sm" onclick="editProd('${p.id}')">âœï¸</button><button class="btn btn-d btn-sm" onclick="delProd('${p.id}')">ğŸ—‘ï¸</button></div></td></tr>`}).join('')||'<tr><td colspan="4"><div class="empty">No products</div></td></tr>'}
function openProdModal(){$('prModalTitle').textContent='Add Product';$('ePrId').value='';$('prName').value='';$('prCat').value='';$('prCost').value='';$('prPrice').value='';$('prWhole').value='';$('prQty').value='';openMod('prModal')}
function editProd(id){const p=products.find(x=>x.id===id);if(!p)return;$('prModalTitle').textContent='Edit Product';$('ePrId').value=p.id;$('prName').value=p.name;$('prCat').value=p.category||'';$('prCost').value=p.cost_price;$('prPrice').value=p.price;$('prWhole').value=p.wholesale_price||'';$('prQty').value=p.quantity;openMod('prModal')}
async function saveProd(){const id=$('ePrId').value,data={shop_id:shop.id,name:$('prName').value.trim(),category:$('prCat').value.trim()||null,cost_price:n($('prCost').value),price:n($('prPrice').value),wholesale_price:n($('prWhole').value),quantity:n($('prQty').value)};if(!data.name||!data.price){toast('Name & Price required',false);return}$('loader').classList.remove('hide');$('loadTxt').textContent='Saving...';let err;if(id)({error:err}=await db.from('products').update(data).eq('id',id));else({error:err}=await db.from('products').insert(data));$('loader').classList.add('hide');if(err){toast('Error',false);return}toast('Saved',true);closeMod('prModal');await loadProducts();renderProducts();renderPOS()}
async function delProd(id){if(!confirm('Delete?'))return;$('loader').classList.remove('hide');await db.from('products').update({active:false}).eq('id',id);$('loader').classList.add('hide');toast('Deleted',true);await loadProducts();renderProducts();renderPOS()}
function renderExpenses(){const mo=new Date().toISOString().slice(0,7);let tot=0;for(const e of expenses)if(e.created_at.slice(0,7)===mo)tot+=n(e.amount);$('expMonth').textContent=m(tot);$('expList').innerHTML=expenses.length?expenses.slice(0,20).map(e=>`<div class="exp-item"><div class="exp-icon">${catIcon(e.category)}</div><div class="exp-info"><div class="exp-title">${e.title}</div><div class="exp-date">${fmtD(e.created_at)}</div></div><div class="exp-amt">-${m(e.amount)}</div><button class="btn btn-d btn-sm" onclick="delExp('${e.id}')">ğŸ—‘ï¸</button></div>`).join(''):'<div class="empty"><span>ğŸ’¸</span>No expenses</div>'}
function openExpModal(){$('expTitle').value='';$('expCat').value='utilities';$('expAmt').value='';openMod('expModal')}
async function saveExp(){const title=$('expTitle').value.trim(),amt=n($('expAmt').value);if(!title||!amt){toast('Title & Amount required',false);return}$('loader').classList.remove('hide');const{error}=await db.from('expenses').insert({shop_id:shop.id,user_id:user.id,title,category:$('expCat').value,amount:amt});$('loader').classList.add('hide');if(error){toast('Error',false);return}toast('Added',true);closeMod('expModal');await loadExpenses();renderExpenses();renderDash()}
async function delExp(id){if(!confirm('Delete?'))return;$('loader').classList.remove('hide');await db.from('expenses').delete().eq('id',id);$('loader').classList.add('hide');toast('Deleted',true);await loadExpenses();renderExpenses();renderDash()}
function renderStaff(){$('sfTbl').innerHTML=staff.map(s=>`<tr><td><b>${s.name}</b></td><td><span style="padding:4px 8px;border-radius:6px;font-size:9px;font-weight:700;background:${s.role==='admin'?'rgba(13,148,136,.1)':'rgba(34,197,94,.1)'};color:${s.role==='admin'?'#0d9488':'#22c55e'}">${s.role}</span></td><td><div style="display:flex;gap:4px"><button class="btn btn-g btn-sm" onclick="editStaff('${s.id}')">âœï¸</button><button class="btn btn-d btn-sm" onclick="delStaff('${s.id}')">ğŸ—‘ï¸</button></div></td></tr>`).join('')||'<tr><td colspan="3"><div class="empty">No staff</div></td></tr>'}
function openStaffModal(){$('sfModalTitle').textContent='Add Staff';$('eSfId').value='';$('sfName').value='';$('sfRole').value='cashier';$('sfPin').value='';openMod('sfModal')}
function editStaff(id){const s=staff.find(x=>x.id===id);if(!s)return;$('sfModalTitle').textContent='Edit Staff';$('eSfId').value=s.id;$('sfName').value=s.name;$('sfRole').value=s.role;$('sfPin').value=s.pin;openMod('sfModal')}
async function saveStaff(){const id=$('eSfId').value,data={shop_id:shop.id,name:$('sfName').value.trim(),role:$('sfRole').value,pin:$('sfPin').value.trim(),active:true};if(!data.name||data.pin.length!==4){toast('Name & 4-digit PIN required',false);return}$('loader').classList.remove('hide');let err;if(id)({error:err}=await db.from('users').update(data).eq('id',id));else({error:err}=await db.from('users').insert(data));$('loader').classList.add('hide');if(err){toast('Error',false);return}toast('Saved',true);closeMod('sfModal');await loadStaff();renderStaff()}
async function delStaff(id){if(!confirm('Delete?'))return;$('loader').classList.remove('hide');await db.from('users').update({active:false}).eq('id',id);$('loader').classList.add('hide');toast('Deleted',true);await loadStaff();renderStaff()}
document.addEventListener('DOMContentLoaded',init);
</script>
</body>
</html>
